"use strict";(self.webpackChunkfuck_web_ui=self.webpackChunkfuck_web_ui||[]).push([[463],{39013:function(e,n,t){t.r(n),t.d(n,{default:function(){return ke}});var r=t(97857),s=t.n(r),a=t(5574),i=t.n(a),o=t(50136),u=t(67294),l=t(99090),c=t(67610),d=t(45606),p=t(81665),f=t(41913),m=t(78158),h=t(25855),v=t(88372),x=t(12444),w=t.n(x),b=t(72004),j=t.n(b),g=t(25098),y=t.n(g),k=t(31996),Z=t.n(k),I=t(26037),U=t.n(I),_=t(9783),P=t.n(_),F=t(15009),N=t.n(F),A=t(99289),M=t.n(A),S=t(2453),C=t(54120),D=t(51413),q=t(14726),B=t(17788),L=t(82088),T="baseView___JGWzE",O="left___p8onf",R="right___hmm3r",E=t(85893),z=function(){var e=M()(N()().mark((function e(n){var t,r,s,a,i,o,u;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,r=n.username,s=n.avatar,a=n.fullName,i=n.phoneNumber,o=n.email,u=S.ZP.loading("Updating ..."),e.prev=2,e.next=5,(0,p.SF)({id:t,username:r,avatar:s,fullName:a,phoneNumber:i,email:o});case 5:return u(),S.ZP.success("Updated successfully"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(2),u(),S.ZP.error("Update failed, please try again!"),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(n){return e.apply(this,arguments)}}(),V=function(e){Z()(t,e);var n=U()(t);function t(){var e;w()(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=n.call.apply(n,[this].concat(a)),P()(y()(e),"view",void 0),P()(y()(e),"getViewDom",(function(n){e.view=n})),P()(y()(e),"handleFinish",function(){var n=M()(N()().mark((function n(t){var r,a,i;return N()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.props,a=r.currentUser,i=r.reload,n.next=3,z(s()(s()({},a),t));case 3:i();case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),e}return j()(t,[{key:"render",value:function(){var e=this.props.currentUser;return(0,E.jsx)("div",{className:T,ref:this.getViewDom,children:(0,E.jsxs)(C.Z,{layout:"vertical",onFinish:this.handleFinish,initialValues:e,requiredMark:!0,style:{display:"flex"},children:[(0,E.jsxs)("div",{className:O,children:[(0,E.jsx)(C.Z.Item,{name:"username",label:this.props.parentIntl.t("basic.username","Username"),children:(0,E.jsx)(D.Z,{disabled:!0})}),(0,E.jsx)(C.Z.Item,{name:"email",label:this.props.parentIntl.t("basic.email"),rules:[{required:!0,message:this.props.parentIntl.t("basic.email-message")}],children:(0,E.jsx)(D.Z,{})}),(0,E.jsx)(C.Z.Item,{name:"fullName",label:this.props.parentIntl.t("basic.fullname"),children:(0,E.jsx)(D.Z,{})}),(0,E.jsx)(C.Z.Item,{name:"phoneNumber",label:this.props.parentIntl.t("basic.phone"),children:(0,E.jsx)(D.Z,{})}),(0,E.jsx)(C.Z.Item,{children:(0,E.jsx)(q.ZP,{htmlType:"submit",type:"primary",children:this.props.parentIntl.t("basic.update","Update Information")})})]}),(0,E.jsxs)("div",{className:R,children:[(0,E.jsx)(C.Z.Item,{name:"avatar",label:this.props.parentIntl.t("basic.avatar","Avatar"),children:(0,E.jsx)(L.G2,{})}),(0,E.jsx)(B.Z,{open:!1})]})]})})}}]),t}(u.Component),G=V,H=t(49677),K=t.n(H),Q=function(e){return K()(e),(0,E.jsx)(E.Fragment,{})},W=t(2487),Y=t(43711),J=t(13769),X=t.n(J),$=t(23968),ee=["request","checked","onChange"],ne=function(e){var n=e.request,t=e.checked,r=e.onChange,a=X()(e,ee),o=(0,u.useState)(!1),l=i()(o,2),c=l[0],d=l[1],p=(0,u.useState)(t),f=i()(p,2),m=f[0],h=f[1];return(0,u.useEffect)((function(){h(t)}),[t]),(0,E.jsx)($.Z,s()({onChange:function(){var e=M()(N()().mark((function e(t,s){return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==r||r(t,s),d(!0),e.next=5,n();case 5:h(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(!t);case 11:return e.prev=11,d(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})));return function(n,t){return e.apply(this,arguments)}}(),loading:c,checked:m},a))},te=t(11475),re=t(37476),se=t(5966),ae=["newPassword2"],ie=function(e){var n=e.parentIntl,t=e.currentUser,r=new f.f("modify-password",n),a=C.Z.useForm(),o=i()(a,1)[0];return(0,E.jsx)(re.Y,{title:r.t("title","Modify Password"),trigger:(0,E.jsx)("a",{children:n.t("modify","Modify")}),form:o,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,maskClosable:!1},width:600,onFinish:function(){var e=M()(N()().mark((function e(n){var r,a;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.newPassword2,a=X()(n,ae),r!=a.newPassword&&S.ZP.error("The passwords entered two times are inconsistent."),e.next=4,(0,p.c0)(s()(s()({},a),{},{username:null==t?void 0:t.username}));case 4:if(!e.sent.success){e.next=8;break}return S.ZP.info("Password updated successfully!"),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:(0,E.jsxs)(v.f,{children:[(0,E.jsx)(se.Z.Password,{rules:[{required:!0}],width:"lg",name:"oldPassword",label:r.t("old-password","Old password")}),(0,E.jsx)(se.Z.Password,{rules:[{required:!0}],width:"lg",name:"newPassword",label:r.t("new-password","New password")}),(0,E.jsx)(se.Z.Password,{rules:[{required:!0}],width:"lg",name:"newPassword2",label:r.t("new-password","New password")})]})})},oe=t(32983),ue=t(84059),le=t(79090),ce=function(e){var n=e.parentIntl,t=void 0===n?new f.f("user.settings.security",(0,l.useIntl)()):n,r=e.hidden,a=e.reload,o=new f.f("mfa-device",t),c=C.Z.useForm(),d=i()(c,1)[0],m=(0,u.useState)(),h=i()(m,2),x=h[0],w=h[1],b=(0,u.useState)(!1),j=i()(b,2),g=j[0],y=j[1],k=function(){var e=M()(N()().mark((function e(){return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w(void 0),y(!0),(0,p.oN)({}).then((function(e){w(e.data)})).finally((function(){y(!1)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,E.jsx)(re.Y,{title:o.t("bind","Bind MFA"),trigger:(0,E.jsx)("a",{hidden:r,children:t.t("bind","Bind")}),form:d,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,maskClosable:!1},hidden:r,onOpenChange:function(e){e&&k()},submitter:{submitButtonProps:{disabled:!x,hidden:r}},onFinish:function(){var e=M()(N()().mark((function e(n){return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==x||!x.token){e.next=7;break}return e.next=3,(0,p.Bp)(s()(s()({},n),{},{token:x.token}));case 3:return a(),e.abrupt("return",!0);case 7:throw new Error("System error: token is null");case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:(0,E.jsxs)(v.f,{children:[(0,E.jsx)("p",{children:o.t("code-description","Please obtain two consecutive one-time passwords after scanning and adding MFA and enter them into the input box below.")}),(0,E.jsxs)("div",{style:{display:"flex"},children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("div",{style:{width:220,height:140},children:null!=x&&x.secret?(0,E.jsx)(ue.Qd,{style:{marginLeft:"40px"},value:null==x?void 0:x.secret}):(0,E.jsx)(oe.Z,{description:"",style:{width:200,height:128},image:g?(0,E.jsx)(le.Z,{}):void 0})}),(0,E.jsx)("div",{style:{display:"grid",width:"100%"},children:(0,E.jsx)(q.ZP,{onClick:k,type:"link",children:o.t("refresh","Refresh")})})]}),(0,E.jsxs)("div",{style:{marginLeft:"30px"},children:[(0,E.jsx)(se.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"firstCode",label:o.t("first-code","First code")}),(0,E.jsx)(se.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"secondCode",label:o.t("second-code","Second code")})]})]})]})})},de=function(e){Z()(t,e);var n=U()(t);function t(e){var r;return w()(this,t),r=n.call(this,e),P()(y()(r),"state",{intl:new f.f("security",r.props.parentIntl)}),P()(y()(r),"t",(function(e,n){var t,s=r.state.intl;return null!==(t=null==s?void 0:s.t(e,n))&&void 0!==t?t:""})),P()(y()(r),"passwordStrength",{strong:(0,E.jsx)("span",{className:"strong",children:r.t("strong","Strong")}),medium:(0,E.jsx)("span",{className:"medium",children:r.t("medium","Medium")}),weak:(0,E.jsx)("span",{className:"weak",children:r.t("weak","Weak")})}),P()(y()(r),"getData",(function(){var e,n,t,s,a,i,o,u,c;return[{title:r.t("password"),actions:[(0,E.jsx)(l.Link,{to:Y.A,children:r.t("resetPassword","Reset")},"reset-password"),(0,E.jsx)(ie,{parentIntl:r.state.intl,currentUser:r.props.currentUser},"modify-password")]},{title:r.t("mfa-phone"),description:"".concat(r.t("mfa-phone-description"),": ").concat(null!==(e=null===(n=r.props.currentUser)||void 0===n?void 0:n.phoneNumber)&&void 0!==e?e:""),actions:[(0,E.jsx)(ne,{request:M()(N()().mark((function e(){var n;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.c9)({sms_as_mfa:!(null!==(n=r.props.currentUser)&&void 0!==n&&null!==(n=n.extendedData)&&void 0!==n&&n.smsAsMFA)});case 2:r.props.reload();case 3:case"end":return e.stop()}}),e)}))),checked:null===(t=r.props.currentUser)||void 0===t||null===(t=t.extendedData)||void 0===t?void 0:t.smsAsMFA,onChange:function(){},size:"small"},"phone")]},{title:r.t("mfa-email"),description:"".concat(r.t("mfa-email-description"),": ").concat(null!==(s=null===(a=r.props.currentUser)||void 0===a?void 0:a.email)&&void 0!==s?s:""),actions:[(0,E.jsx)(ne,{checked:null===(i=r.props.currentUser)||void 0===i||null===(i=i.extendedData)||void 0===i?void 0:i.emailAsMFA,request:M()(N()().mark((function e(){var n;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.c9)({email_as_mfa:!(null!==(n=r.props.currentUser)&&void 0!==n&&null!==(n=n.extendedData)&&void 0!==n&&n.emailAsMFA)});case 2:r.props.reload();case 3:case"end":return e.stop()}}),e)}))),size:"small"},"email")]},{title:r.t("mfa-device"),description:null!==(o=r.props.currentUser)&&void 0!==o&&null!==(o=o.extendedData)&&void 0!==o&&o.totpAsMFA?r.t("mfa-device-description-bound"):r.t("mfa-device-description-unbound"),actions:[(0,E.jsx)(ce,{parentIntl:r.state.intl,currentUser:r.props.currentUser,hidden:null===(u=r.props.currentUser)||void 0===u||null===(u=u.extendedData)||void 0===u?void 0:u.totpAsMFA,reload:r.props.reload},"mfa-binding"),(0,E.jsx)("a",{hidden:!(null!==(c=r.props.currentUser)&&void 0!==c&&null!==(c=c.extendedData)&&void 0!==c&&c.totpAsMFA),onClick:function(){B.Z.confirm({title:r.t("unbind-confirm","Are you sure you want to unbind the mfa device?"),icon:(0,E.jsx)(te.Z,{}),onOk:r.unbindMFADevice(r.props)})},children:r.t("unbind","Unbind")},"mfa-unbind")]}]})),r.state={intl:new f.f("security",r.props.parentIntl)},r}return j()(t,[{key:"unbindMFADevice",value:function(e){return M()(N()().mark((function n(){var t;return N()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=S.ZP.loading("Unbinding ..."),n.prev=1,n.next=4,(0,p.c9)({totp_as_mfa:!1});case 4:return t(),S.ZP.success("Unbind successfully and will refresh soon"),e.reload(),n.abrupt("return",!0);case 10:return n.prev=10,n.t0=n.catch(1),console.log(n.t0),t(),S.ZP.error("Unbind failed, please try again"),n.abrupt("return",!1);case 16:case"end":return n.stop()}}),n,null,[[1,10]])})))}},{key:"render",value:function(){var e=this.getData();return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(W.Z,{itemLayout:"horizontal",dataSource:e,renderItem:function(e){return(0,E.jsx)(W.Z.Item,{actions:e.actions,children:(0,E.jsx)(W.Z.Item.Meta,{title:e.title,description:e.description})})}})})}}]),t}(u.Component),pe=t(30381),fe=t.n(pe),me=t(78824),he=t(55431),ve=function(){var e=M()(N()().mark((function e(n){var t;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!0);case 2:return t=S.ZP.loading("Deleting ..."),e.prev=3,e.next=6,(0,p._7)({id:n});case 6:return t(),S.ZP.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),t(),S.ZP.error("Delete failed, please try again"),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(n){return e.apply(this,arguments)}}(),xe=function(e){var n=e.currentUser,t=e.parentIntl,r=new f.f("sessions",t),a=(0,u.useRef)(),i=[{title:r.t("session.title.lastSeen","Last Seen"),dataIndex:"lastSeen",render:function(e,n){return fe()(n.lastSeen).locale(r.locale).fromNow()}},{title:r.t("session.title.expiry","Expiry"),dataIndex:"expiry",render:function(e,n){return fe()(n.expiry).locale(r.locale).fromNow()}},{title:r.t("session.title.loggedOn","Logged on"),dataIndex:"createTime",render:function(e,n){return fe()(n.createTime).locale(r.locale).format("LLL")}},{render:function(e,n){return[(0,E.jsx)("a",{onClick:M()(N()().mark((function e(){var t;return N()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve(n.id);case 2:if(!e.sent){e.next=4;break}null===(t=a.current)||void 0===t||t.reload();case 4:case"end":return e.stop()}}),e)}))),children:(0,E.jsx)(me.Z,{})},"delete")]}}];return n?(0,E.jsx)(he.ZP,{actionRef:a,toolBarRender:!1,request:function(e){return(0,p.H2)(s()(s()({},e),{},{userId:n.id}))},columns:i,rowKey:"id",search:!1}):null},we="main___UrmfN",be="leftMenu___rEtBF",je="right___b7Qyk",ge="title___rBU8e",ye=o.Z.Item,ke=function(){var e,n,t,r=new f.f("user.settings",(0,l.useIntl)()),a=(0,u.useRef)(null),x={base:r.t("menuMap.basic","Basic Settings"),security:r.t("menuMap.security","Security Settings"),binding:r.t("menuMap.binding","Account Binding"),sessions:r.t("menuMap.sessions","Sessions")},w=(0,l.useModel)("@@initialState"),b=w.initialState,j=w.setInitialState,g=(0,u.useState)(null==b?void 0:b.currentUser),y=i()(g,2),k=y[0],Z=y[1],I=function(){var e=(null!=k?k:{}).fetchTime;e&&e+1>Number(new Date)/1e3||(0,p.ar)().then((function(e){e.data&&(j(s()(s()({},b),{},{currentUser:s()(s()({},e.data),{},{fetchTime:Number(new Date)/1e3})})),Z(s()(s()({},e.data),{},{fetchTime:Number(new Date)/1e3})))}))};(0,u.useEffect)((function(){I()}),[]);var U=(0,u.useState)("base"),_=i()(U,2),P=_[0],F=_[1],N=null!==(e=null==b?void 0:b.globalConfig)&&void 0!==e?e:null;return(0,E.jsx)(h.ZP,{logo:null!==(n=null==N?void 0:N.logo)&&void 0!==n?n:(0,m.Ak)("logo.svg"),title:null!==(t=null==N?void 0:N.title)&&void 0!==t?t:c.Z.title,onMenuHeaderClick:function(){l.history.push("/")},layout:"top",navTheme:"dark",rightContentRender:function(){return(0,E.jsx)(d.Z,{})},children:(0,E.jsx)(v.f,{children:(0,E.jsxs)("div",{className:we,ref:a,children:[(0,E.jsx)("div",{className:be,children:(0,E.jsx)(o.Z,{mode:"inline",selectedKeys:[P],onClick:function(e){var n=e.key;return F(n)},children:Object.keys(x).map((function(e){return(0,E.jsx)(ye,{children:x[e]},e)}))})}),(0,E.jsxs)("div",{className:je,children:[(0,E.jsx)("div",{className:ge,children:x[P]}),function(){switch(P){case"base":return(0,E.jsx)(G,{parentIntl:r,currentUser:k,reload:I});case"security":return(0,E.jsx)(de,{parentIntl:r,currentUser:k,reload:I});case"binding":return(0,E.jsx)(Q,{});case"sessions":return(0,E.jsx)(xe,{parentIntl:r,currentUser:k})}return null}()]})]})})})}}}]);