"use strict";(self.webpackChunkfuck_web_ui=self.webpackChunkfuck_web_ui||[]).push([[787],{15089:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});var r=n(97857),a=n.n(r),i=n(5574),u=n.n(i),s=n(15009),o=n.n(s),c=n(99289),l=n.n(c),p=n(2453),d=n(96074),f=n(86738),h=n(14726),m=n(17788),v=n(2487),x=n(98321),w=n(30381),b=n.n(w),y=n(67294),g=n(99090),k=n(16828),j=n(41913),Z=n(51042),C=n(11475),P=n(66482),S=n(29052),I=n(36541),D=n(55431),T=n(13769),A=n.n(T),E=n(31673),Y=n(78158);function F(){return(F=l()(o()().mark((function e(t,n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Y.WY)("/api/v1/permissions",a()({method:"GET",params:a()({},t)},n||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=n(12661),L=n(5966),V=n(85893),W=["parentIntl"],_=function(e){var t=e.parentIntl,n=A()(e,W),r=new j.f("form",t),i=(0,y.useState)(!1),s=u()(i,2),c=s[0],p=s[1],d=n.values,f=n.modalVisible,h=n.onSubmit,v=n.onCancel,x=(0,y.useState)([]),w=u()(x,2),b=w[0],g=w[1],k=(0,y.useState)([]),Z=u()(k,2),P=Z[0],S=Z[1],I=(0,y.useState)(500),D=u()(I,2),T=D[0],Y=D[1],_=(0,y.useState)(0),z=u()(_,2),H=z[0],O=z[1];(0,y.useEffect)((function(){var e=function(){window.innerHeight>640?Y(window.innerHeight-440):Y(200)};e(),window.addEventListener("resize",e)}),[]),(0,y.useEffect)((function(){f&&(O(0),S(null!=d&&d.permission?d.permission.map((function(e){return e.id})):[]),p(!0),function(e,t){return F.apply(this,arguments)}({pageSize:3e3}).then((function(e){e.success&&e.data&&g(e.data)})).finally((function(){p(!1)})))}),[d,f]);return(0,V.jsxs)(R.L0,{stepsProps:{size:"small"},current:H,onCurrentChange:O,formProps:{preserve:!1},stepsFormRender:function(e,t){return(0,V.jsx)(m.Z,{width:640,confirmLoading:c,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:r.t(d?"title.roleUpdate":"title.roleCreate",d?"Modify role":"Add role"),style:{maxHeight:"calc(100vh - 200px)"},open:f,footer:t,onCancel:function(){m.Z.confirm({title:r.t("cancel?","Cancel editing?"),icon:(0,V.jsx)(C.Z,{}),onOk:function(){v()},maskClosable:!0})},children:e})},onFinish:function(){var e=l()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h(a()(a()({},t),{},{permission:P})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[(0,V.jsxs)(R.L0.StepForm,{initialValues:d,labelCol:{span:8},wrapperCol:{span:14},layout:"horizontal",title:r.t("basicConfig","Basic information"),children:[(0,V.jsx)(L.Z,{hidden:!0,name:"id"}),(0,V.jsx)(L.Z,{name:"name",label:r.t("name.label","Name"),width:"md",rules:[{required:!0,message:r.t("name.required","Please input role name!")}]}),(0,V.jsx)(L.Z,{name:"description",label:r.t("description.label","Description"),width:"md"})]}),(0,V.jsx)(R.L0.StepForm,{initialValues:{},title:r.t("permission.title","Permission"),children:(0,V.jsx)(E.Z,{checkable:!0,height:T,defaultExpandAll:!0,checkedKeys:P,onCheck:function(e){S(e)},treeData:function e(t,n){if(void 0===t)return[];var r=[],a=t;return a.forEach((function(t,i){if(t.parentId===n){var u=e(a,t.id);u.length>0?r.push({key:a[i].id,title:a[i].description?a[i].description:a[i].name,children:u}):r.push({key:a[i].id,title:a[i].description?a[i].description:a[i].name})}})),r}(b,"")})})]})},z=function(){var e=l()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.ZP.loading("Adding ..."),e.prev=1,delete t.id,e.next=5,(0,k.fA)(t);case 5:return n(),p.ZP.success("Added successfully"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(1),n(),e.t0.handled||p.ZP.error("Adding failed, please try again!"),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=l()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.ZP.loading("Configuring"),e.prev=1,!t.id){e.next=10;break}return e.next=5,(0,k.ul)({id:t.id},t);case 5:return n(),p.ZP.success("update is successful"),e.abrupt("return",!0);case 10:return p.ZP.success("update failed, system error"),e.abrupt("return",!1);case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(1),n(),e.t0.handled||p.ZP.error("Update failed, please try again!"),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=l()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.ZP.loading("Deleting ..."),t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,k.ZV)(t.map((function(e){return{id:e.id}})));case 6:return n(),p.ZP.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),n(),p.ZP.error("Delete failed, please try again: ".concat(e.t0)),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,y.useState)(!1),t=u()(e,2),n=t[0],r=t[1],i=(0,y.useState)(!1),s=u()(i,2),c=s[0],p=s[1],w=(0,y.useRef)(),T=(0,y.useState)(),A=u()(T,2),E=A[0],Y=A[1],F=(0,y.useState)([]),R=u()(F,2),L=R[0],W=R[1],q=(0,y.useState)(),K=u()(q,2),M=K[0],U=K[1],B=new j.f("pages.roles",(0,g.useIntl)()),G=function(){var e=l()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a()({},t),M&&(n=a()({keywords:M},n)),e.abrupt("return",(0,k.F3)(n));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=[{title:B.t("title.name","Role Name"),dataIndex:"name"},{title:B.t("title.describe","Describe"),dataIndex:"describe"},{title:B.t("title.createTime","Create Time"),dataIndex:"create_time",render:function(e,t){return b()(t.createTime).locale(B.locale).format("YYYY-MM-DD HH:mm:ss")}},{title:B.t("title.operate","Operate"),dataIndex:"option",valueType:"option",render:function(e,t){return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("a",{onClick:function(){r(!0),Y(t)},children:B.t("button.change","Change")},"change"),(0,V.jsx)(d.Z,{type:"vertical"}),(0,V.jsx)(f.Z,{title:B.t("delete.popconfirm","Are you sure you want to delete the role named: {name}?",void 0,{name:t.name}),onConfirm:l()(o()().mark((function e(){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O([t]);case 2:if(!e.sent){e.next=4;break}null===(n=w.current)||void 0===n||n.reload();case 4:case"end":return e.stop()}}),e)}))),children:(0,V.jsx)("a",{children:B.t("button.delete","Delete")})},"delete")]})}}];return(0,V.jsxs)(P._z,{children:[(0,V.jsx)(D.ZP,{actionRef:w,rowKey:"id",search:!1,toolbar:{search:!0,onSearch:function(e){var t,n;(U(e),w.current)&&(null===(t=(n=w.current).setPageInfo)||void 0===t||t.call(n,a()(a()({},w.current.pageInfo),{},{current:1})),w.current.reload())},actions:[(0,V.jsxs)(h.ZP,{type:"primary",onClick:function(){r(!0)},children:[(0,V.jsx)(Z.Z,{}),B.t("button.create","Create")]},"create")]},request:G,columns:N,tableAlertRender:!1,rowSelection:{onChange:function(e,t){W(t)}}}),(null==L?void 0:L.length)>0&&(0,V.jsx)(S.S,{extra:(0,V.jsxs)("div",{children:[B.t("chosen","Chosen")," ",(0,V.jsx)("a",{style:{fontWeight:600},children:L.length})," ",B.t("item","Item(s)")]}),children:(0,V.jsx)(h.ZP,{danger:!0,onClick:function(){m.Z.confirm({title:B.t("delete.confirm","Are you sure you want to delete the following roles?            "),icon:(0,V.jsx)(C.Z,{}),onOk:function(){return l()(o()().mark((function e(){var t,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(L);case 2:W([]),null===(t=w.current)||void 0===t||null===(n=t.reloadAndRest)||void 0===n||n.call(t);case 4:case"end":return e.stop()}}),e)})))()},content:(0,V.jsx)(v.Z,{dataSource:L,rowKey:"id",renderItem:function(e){return(0,V.jsx)(v.Z.Item,{children:e.name})}})})},children:B.t("button.batchDeletion","Batch deletion")})}),(0,V.jsx)(_,{onSubmit:function(){var e=l()(o()().mark((function e(t){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(E?H:z)(t);case 2:return(n=e.sent)&&(r(!1),Y(void 0),w.current&&w.current.reload()),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onCancel:function(){r(!1),c||Y(void 0)},modalVisible:n,values:E,parentIntl:B}),(0,V.jsx)(x.Z,{width:600,open:c,onClose:function(){Y(void 0),p(!1)},closable:!1,children:c&&(null==E?void 0:E.id)&&(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(I.ZP,{column:2,title:B.t("detail.title","Role Details"),request:l()(o()().mark((function e(){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:E||{}});case 1:case"end":return e.stop()}}),e)}))),params:{id:null==E?void 0:E.id},columns:N})})})]})}},16828:function(e,t,n){n.d(t,{F3:function(){return f},ZV:function(){return x},fA:function(){return m},ul:function(){return b}});var r=n(13769),a=n.n(r),i=n(15009),u=n.n(i),s=n(97857),o=n.n(s),c=n(99289),l=n.n(c),p=n(78158),d=["id"];function f(e,t){return h.apply(this,arguments)}function h(){return(h=l()(u()().mark((function e(t,n){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/v1/roles",o()({method:"GET",params:o()({},t)},n||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return v.apply(this,arguments)}function v(){return(v=l()(u()().mark((function e(t,n){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/v1/roles",o()({method:"POST",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t){return w.apply(this,arguments)}function w(){return(w=l()(u()().mark((function e(t,n){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/v1/roles",o()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t,n){return y.apply(this,arguments)}function y(){return(y=l()(u()().mark((function e(t,n,r){var i,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.id,s=a()(t,d),e.abrupt("return",(0,p.WY)("/api/v1/roles/".concat(i),o()({method:"PUT",headers:{"Content-Type":"application/json"},params:o()({},s),data:n},r||{})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);